generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
  engineType      = "library"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                   String             @id @default(cuid())
  supabaseId           String             @unique
  email                String             @unique
  name                 String?
  username             String?            @unique
  imageUrl             String?
  bio                  String?
  subscriptionTier     SubscriptionTier   @default(FREE)
  subscriptionStatus   SubscriptionStatus @default(ACTIVE)
  stripeCustomerId     String?            @unique
  stripeSubscriptionId String?            @unique
  credits              Int                @default(10)
  creditsUsed          Int                @default(0)
  lastCreditReset      DateTime           @default(now())
  defaultTone          ContentTone?
  defaultWordCount     Int?               @default(800)
  preferredLanguage    String             @default("en")
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  lastLoginAt          DateTime?
  contentTypes         String[]           @default([])
  onboardingCompleted  Boolean            @default(false)
  onboardingStep       Int                @default(0)
  primaryGoal          String?
  mostFrequentContent  String?
  contents             Content[]
  usageHistory         UsageHistory[]

  @@index([supabaseId])
  @@index([email])
  @@index([onboardingCompleted])
}

model Content {
  id        String   @id @default(cuid())
  userId    String
  title     String
  content   String
  wordCount Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tone      String?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model UsageHistory {
  id          String   @id @default(cuid())
  userId      String
  tokensUsed  Int?
  creditsUsed Int      @default(1)
  createdAt   DateTime @default(now())
  action      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum SubscriptionTier {
  FREE
  PRO
  BUSINESS
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  TRIALING
}

enum ContentTone {
  PROFESSIONAL
  CASUAL
  FRIENDLY
  TECHNICAL
  PERSUASIVE
  EDUCATIONAL
}
